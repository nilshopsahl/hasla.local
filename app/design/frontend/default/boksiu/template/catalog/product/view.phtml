<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2013 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */

/**
 * Product view template
 *
 * @see Mage_Catalog_Block_Product_View
 * @see Mage_Review_Block_Product_View
 */
?>
<?php $_helper = $this->helper('catalog/output'); ?>
<?php $_product = $this->getProduct(); ?>
<?php $curr_category = Mage::registry('current_category'); 

		$shopbycat = explode(",",Mage::getModel("catalog/category")->load(7)->getChildren());
		$shopbycat[] = 7;
		$shopbycat[] = 2;
		$shopbycat[] = 22;
		$bunad = explode(",",Mage::getModel("catalog/category")->load(57)->getChildren());
		$bunad[] = 57;
		$katalog = explode(",",Mage::getModel("catalog/category")->load(37)->getChildren());
		$katalog[] = 37;
?>
<script type="text/javascript">
    var optionsPrice = new Product.OptionsPrice(<?php echo $this->getJsonConfig() ?>);
</script>
<div id="messages_product_view"><?php echo $this->getMessagesBlock()->getGroupedHtml() ?></div>
<div class="main_slider product-view">
    <?php //if($curr_category):?>
    
    <div class="product_list_left">
        <div class="thumb_nail_01">
            <div class="img"> <?php if($curr_category){ ?> <img width="160px" height="160px" src="<?php echo Mage::getBaseUrl('media').'catalog/category/'.$curr_category->getData('thumbnail')?>" /> <?php }?></div>
            <div class="spacer"></div>
        </div>
        <div class="spacer"></div>
        <ul>
            
			<?php if($curr_category && in_array($curr_category->getId(),$shopbycat)):?>
			
				<?php 
					//$catg_coll = Mage::getModel('catalog/category')->getCollection()->setOrder('name','ASC');
					//$catg_coll = Mage::getModel('catalog/category')->getCollection();
					$catg_coll = Mage::getModel('catalog/category')->load(7)->getChildrenCategories();
					
					foreach($catg_coll as $catg_data):
					if(in_array($catg_data->getId(),$shopbycat) && $catg_data->getId()>2):	
					$catg_data = Mage::getModel('catalog/category')->load($catg_data->getId());
					if($catg_data->getName() != 'Shop By Collection' && $catg_data->getName() != 'Kolleksjon'){
				?>
						<li><a id="<?php if($curr_category && $catg_data->getId()==$curr_category->getData('entity_id')):?>left_product_active<?php endif;?>" href="<?php echo $catg_data->getUrl();?>"><?php echo $catg_data->getName();?></a></li>
						<?php } ?>
					<?endif;?>
				<?php endforeach;?>
			<?php elseif($curr_category && in_array($curr_category->getId(),$bunad) && $curr_category->getId()!='57'):?>
			
				<?php 
					$catg_coll = Mage::getModel('catalog/category')->getCollection();
					foreach($catg_coll as $catg_data):
					if(in_array($catg_data->getId(),$bunad) && $catg_data->getId()>2):	
					$catg_data = Mage::getModel('catalog/category')->load($catg_data->getId());
				?>
						<li><a id="<?php if($curr_category && $catg_data->getId()==$curr_category->getData('entity_id')):?>left_product_active<?php endif;?>" href="<?php echo $catg_data->getUrl();?>"><?php echo $catg_data->getName();?></a></li>
					<?endif;?>
				<?php endforeach;?>
				
			<?php elseif($curr_category && in_array($curr_category->getId(),$katalog) && $curr_category->getId()!='57'):?>
			
				<?php 
					$catg_coll = Mage::getModel('catalog/category')->getCollection();
					foreach($catg_coll as $catg_data):
					if(in_array($catg_data->getId(),$katalog) && $catg_data->getId()>2):	
					$catg_data = Mage::getModel('catalog/category')->load($catg_data->getId());
				?>
						<li><a id="<?php if($curr_category && $catg_data->getId()==$curr_category->getData('entity_id')):?>left_product_active<?php endif;?>" href="<?php echo $catg_data->getUrl();?>"><?php echo $catg_data->getName();?></a></li>
					<?endif;?>
				<?php endforeach;?>	
				
			<?php else:?>
				
				<?php 
					$catg_coll = Mage::getModel('catalog/category')->getCollection();
					foreach($catg_coll as $catg_data):
					if(!in_array($catg_data->getId(),$shopbycat) && !in_array($catg_data->getId(),$bunad) && !in_array($catg_data->getId(),$katalog) && $catg_data->getId()>2):	
					$catg_data = Mage::getModel('catalog/category')->load($catg_data->getId());
				?>
						<li><a id="<?php if($curr_category && $catg_data->getId()==$curr_category->getData('entity_id')):?>left_product_active<?php endif;?>" href="<?php echo $catg_data->getUrl();?>"><?php echo $catg_data->getName();?></a></li>
					<?endif;?>
				<?php endforeach;?>
				
			<?php endif;?>
			
        </ul>
        <div class="spacer"></div>
		
    </div>
    
    <?php //endif;?>
    
    <div class="right_internal">
    <div class="product-essential">
    <form action="<?php echo $this->getSubmitUrl($_product) ?>" method="post" id="product_addtocart_form"<?php if($_product->getOptions()): ?> enctype="multipart/form-data"<?php endif; ?>>
        <?php echo $this->getBlockHtml('formkey') ?>
        <div class="no-display">
            <input type="hidden" name="product" value="<?php echo $_product->getId() ?>" />
            <input type="hidden" name="related_product" id="related-products-field" value="" />
        </div>
	<div class="left_internal_slider">
            <div class="product_detail_div">
                
                <?php echo $this->getChildHtml('media') ?>
                <div class="right_details">
                    <h1><?php //echo $this->__('COLLECTION').': '; ?><?php echo $_helper->productAttribute($_product, $_product->getName(), 'name') ?></h1>
					<br />
                    <?php if ($_product->getShortDescription()):?>
                    <span>
                        <?php  $shortdisc = $_helper->productAttribute($_product, nl2br($_product->getShortDescription()), 'short_description'); 
						
						echo $shortdiscresult = $shortdisc; //substr($shortdisc, 0,65).'.';
						?>
                    </span>
					 <br/><br/><br/>
                     <?php endif;?>
					
					 <!-- Add Art No. -->
					   <?php if ($_product->getArt_no()):?>
                    <span style="width: 179px;">
					<?php //echo $labelart_no = $_product->getResource()->getAttribute('art_no')->getFrontend()->getLabel($_product).' : '; ?>
					<?php echo $labelart_no = $_product->getResource()->getAttribute('art_no')->getStoreLabel().' : '; ?>
					<?php echo $_helper->productAttribute($_product, nl2br($_product->getArt_no()), 'art_no'); ?>
                    </span>
                     <?php endif;?>
					 
					<!-- Add Dimentions -->
					<?php if ($_product->getDimensions()):?>
                    <span style="width: 179px;">
					<?php //echo $labeldimensions = $_product->getResource()->getAttribute('dimensions')->getFrontend()->getLabel($_product).' : '; ?>
					<?php echo $labeldimensions = $_product->getResource()->getAttribute('dimensions')->getStoreLabel().' : '; ?>
                    <?php echo $_helper->productAttribute($_product, nl2br($_product->getDimensions()), 'dimensions'); ?>
                    </span>
                     <?php endif;?>
					 
					 <!-- Add Sizes -->
					<?php if ($_product->getSizes()):?>
                    <span style="width: 179px;">
					<?php //echo $labelsize = $_product->getResource()->getAttribute('size')->getFrontend()->getLabel($_product).' : '; ?>
					<?php echo $labelsize = $_product->getResource()->getAttribute('size')->getStoreLabel().' : '; ?>
                    <?php echo $_helper->productAttribute($_product, nl2br($_product->getSizes()), 'size'); ?>
                    </span>
                     <?php endif;?>
					 
                    <?php if ($_product->isSaleable() && $this->hasOptions()):?>
                        <?php echo $this->getChildChildHtml('container1', '', true, true) ?>
                    <?php endif;?>
					
					<?php if (!$this->hasOptions()):?>
						<div style="margin-top:115px; clear:both; " >
							<?php echo $this->getChildHtml('addtocart') ?>
						</div>
					<?php endif; ?>
                    
               </div>
			   <div class="spacer"></div>
            </div>
			
			<?php  echo $this->getChildHtml('media1') ?>
			<div class="spacer"></div>
            
            
            <?php //echo $this->getReviewsSummaryHtml($_product, false, true)?>
            <?php //echo $this->getChildHtml('alert_urls') ?>
            <?php //echo $this->getChildHtml('product_type_data') ?>
            <?php //echo $this->getTierPriceHtml() ?>
            <?php //echo $this->getChildHtml('extrahint') ?>

            <!--<?php //if (!$this->hasOptions()):?>
                <div class="add-to-box">
                    <?php //if($_product->isSaleable()): ?>
                        <?php //echo $this->getChildHtml('addtocart') ?>
                        <?php //if( $this->helper('wishlist')->isAllow() || $_compareUrl=$this->helper('catalog/product_compare')->getAddUrl($_product)): ?>
                            <span class="or"><?php //echo $this->__('OR') ?></span>
                        <?php //endif; ?>
                    <?php //endif; ?>
                    <?php //echo $this->getChildHtml('addto') ?>
                </div>
                <?php //echo $this->getChildHtml('extra_buttons') ?>
            <?php //elseif (!$_product->isSaleable()): ?>
                <div class="add-to-box">
                    <?php //echo $this->getChildHtml('addto') ?>
                </div>
            <?php //endif; ?>-->

            
            <!--<?php //echo $this->getChildHtml('other');?>-->

            
        </div>
        
		    <div class="interanl_about_div">
            <h1><?php echo $this->__("ABOUT")?></h1>
            <p><?php echo $_helper->productAttribute($_product, nl2br($_product->getDescription()), 'description') ?></p>
            <!--<span>YOUR REVIEW</span>
            <img src="images/stars.png" width="98" height="18" />
            -->								
			
            <?php //echo $this->getReviewsSummaryHtml($_product, false, true)?>
            
            <!--<div class="chat_button"><a href="#">Chat</a></div>-->
            <div class="about_likes_buttn">
                <div class="like_01">
                    <a href="<?php echo Mage::getBaseUrl()."sizeguide"?>" target="_blank"><?php echo $this->__("SIZEGUIDE")?></a>
                </div>
				<div class="spacer">&nbsp;</div>
                <div class="fb_like">
                    <!-- <a href="#"><img src="<?php echo $this->getSkinUrl('images/fb_icon.jpg')?>" width="24" height="21" /></a>
                    <label><a href="#">Link</a></label> -->
                    <!--Facebook like button code starts here  -->

    <?php $CurrentUrl = urlencode(Mage::helper('core/url')->getCurrentUrl()); ?>
    
   <iframe src="http://facebook.com/plugins/like.php?href=<?php echo $CurrentUrl; ?>&layout=button_count&show_faces=true&width=450&action=like&font=arial&colorscheme=light&height=21"  
 schrollowing="no" frameborder="0" style="border:none; overflow:hidden; width:450px; height:21px" allowTransparency="true"> </iframe> 

<!--Facebook like button code ends here  -->
                </div>

            </div>
			
			<?php echo $this->getChildHtml('addto') ?>
            
			<div class="spacer"></div>
			<?php
				
				$related_prods = $_product->getRelatedProductIds(); 
				if(count($related_prods) > 0){				
				?>
			<div class="related_product_div">
                        	<h1><?php echo $this->__("RELATED PRODUCTS")?></h1>
                            <div class="related_img_main">
                            <?php
				
							foreach($related_prods as $related){
							$_rel = Mage::getModel('catalog/product')->load($related); ?>
							<div class="related_01">
							<a href="<?php echo $_rel->getProductUrl(); ?>" title="<?php echo $_rel->getName(); ?>">
							<img src="<?php echo $_rel->getImageUrl(); ?>" width="75" height="75" alt="" style="border-bottom: 1px solid #3b3d43;"/>
							</a>
							</div>
							<?php	} ?>
					
                            	<div class="spacer"></div>
                            </div>
                        	<div class="spacer"></div>
                        </div>
						<?php } ?>
        
	
            <div class="spacer"></div>
        </div>
        <!--<div class="product-img-box">
            <?php // echo $this->getChildHtml('media') ?>
        </div>-->
       <div class="spacer"></div>
      
			
					 
					 <?php
					/**
					* Determine the previous/next link and link to current category
					*/
					$_product = $this->getProduct();
					$_ccat = $this->helper('catalog/data')->getCategory();
					
					if(count($_ccat) > 0){
					$ppos         = $_ccat->getProductsPosition();
					$current_pid  = $this->helper('catalog/data')->getProduct()->getId();
					// build array from products positions
					$plist = array();
					foreach ($ppos as $pid => $pos) {
					$plist[] = $pid;
					}
					$curpos   = array_search($current_pid, $plist);
					// get link for prev product
					$previd   = isset($plist[$curpos+1])? $plist[$curpos+1] : $current_pid;
					$product  = Mage::getModel('catalog/product')->load($previd);
					$prevpos  = $curpos;
					while (!$product->isVisibleInCatalog()) {
					$prevpos += 1;
					$nextid   = isset($plist[$prevpos])? $plist[$prevpos] : $current_pid;
					$product  = Mage::getModel('catalog/product')->load($nextid);
					}
					$prev_url = $product->getProductUrl();
					// get link for next product
					$nextid   = isset($plist[$curpos-1])? $plist[$curpos-1] : $current_pid;
					$product  = Mage::getModel('catalog/product')->load($nextid);
					$nextpos  = $curpos;
					while (!$product->isVisibleInCatalog()) {
					$nextpos -= 1;
					$nextid   = isset($plist[$nextpos])? $plist[$nextpos] : $current_pid;
					$product  = Mage::getModel('catalog/product')->load($nextid);
					}
					$next_url = $product->getProductUrl();
					// get link for current category
					$more_url = $_ccat->getUrl();
					?>
					<div  class="next_preview1">
						<?php  if($_product->getProductUrl()!= $next_url){ ?>							
								<a class="product-prev" href="<?php echo $next_url;?>"> < <?php echo $this->__("PREVIOUS PRODUCT")?></a>
							&nbsp;&nbsp;&nbsp;&nbsp;
						<?php } ?>
						<?php if(($_product->getProductUrl()!= $next_url) && ($_product->getProductUrl()!= $prev_url) ) {?>						
						<?php } ?>
						
							<a class="overview" href="<?php  echo $more_url;?>"><?php echo $this->__("BACK TO OVERVIEW")?></a>
						&nbsp;&nbsp;&nbsp;&nbsp;
						<?php  if($_product->getProductUrl()!= $prev_url){ ?>
						
							<a class="product-next" href="<?php  echo $prev_url;?>"><?php echo $this->__("NEXT PRODUCT")?> > </a>
						
						<?php } ?>
					
					</div>
										
					<div class="spacer"></div>
					</div>
					<?php } ?>
					
					
       <div class="spacer"></div>
        <div class="clearer"></div>
        <?php if ($_product->isSaleable() && $this->hasOptions()):?>
            <?php echo $this->getChildChildHtml('container2', '', true, true) ?>
        <?php endif;?>
    </form>
    <script type="text/javascript">
    //<![CDATA[
        var productAddToCartForm = new VarienForm('product_addtocart_form');
        productAddToCartForm.submit = function(button, url) {
            if (this.validator.validate()) {
                var form = this.form;
                var oldUrl = form.action;

                if (url) {
                   form.action = url;
                }
                var e = null;
                try {
                    this.form.submit();
                } catch (e) {
                }
                this.form.action = oldUrl;
                if (e) {
                    throw e;
                }

                if (button && button != 'undefined') {
                    button.disabled = true;
                }
            }
        }.bind(productAddToCartForm);

        productAddToCartForm.submitLight = function(button, url){
            if(this.validator) {
                var nv = Validation.methods;
                delete Validation.methods['required-entry'];
                delete Validation.methods['validate-one-required'];
                delete Validation.methods['validate-one-required-by-name'];
                // Remove custom datetime validators
                for (var methodName in Validation.methods) {
                    if (methodName.match(/^validate-datetime-.*/i)) {
                        delete Validation.methods[methodName];
                    }
                }

                if (this.validator.validate()) {
                    if (url) {
                        this.form.action = url;
                    }
                    this.form.submit();
                }
                Object.extend(Validation.methods, nv);
            }
        }.bind(productAddToCartForm);
    //]]>
    </script>
    </div>

    </div>
	
	<?php echo $this->getChildHtml('product_additional_data') ?>
	
    <!--<div class="product-collateral">
<?php foreach ($this->getChildGroup('detailed_info', 'getChildHtml') as $alias => $html):?>
        <div class="box-collateral <?php echo "box-{$alias}"?>">
            <?php if ($title = $this->getChildData($alias, 'title')):?>
            <h2><?php echo $this->escapeHtml($title); ?></h2>
            <?php endif;?>
            <?php echo $html; ?>
        </div>
<?php endforeach;?>
        <?php echo $this->getChildHtml('upsell_products') ?>
        <?php echo $this->getChildHtml('product_additional_data') ?>
</div>-->
</div>

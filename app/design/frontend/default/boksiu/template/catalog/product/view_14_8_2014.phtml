<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magentocommerce.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magentocommerce.com for more information.
 *
 * @category    design
 * @package     base_default
 * @copyright   Copyright (c) 2013 Magento Inc. (http://www.magentocommerce.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */

/**
 * Product view template
 *
 * @see Mage_Catalog_Block_Product_View
 * @see Mage_Review_Block_Product_View
 */
?>
<?php $_helper = $this->helper('catalog/output'); ?>
<?php $_product = $this->getProduct(); ?>
<?php $curr_category = Mage::registry('current_category'); 

		$shopbycat = explode(",",Mage::getModel("catalog/category")->load(7)->getChildren());
		$shopbycat[] = 7;
		$shopbycat[] = 2;
		$shopbycat[] = 22;
		$bunad = explode(",",Mage::getModel("catalog/category")->load(23)->getChildren());
		$bunad[] = 23;
?>
<script type="text/javascript">
    var optionsPrice = new Product.OptionsPrice(<?php echo $this->getJsonConfig() ?>);
</script>
<div id="messages_product_view"><?php echo $this->getMessagesBlock()->getGroupedHtml() ?></div>
<div class="main_slider product-view">
    <?php //if($curr_category):?>
    
    <div class="product_list_left">
        <div class="thumb_nail_01">
            <div class="img"> <?php if($curr_category){ ?> <img width="160px" height="160px" src="<?php echo Mage::getBaseUrl('media').'catalog/category/'.$curr_category->getData('thumbnail')?>" /> <?php }?></div>
            <div class="spacer"></div>
        </div>
        <div class="spacer"></div>
        <ul>
            
			<?php if($curr_category && in_array($curr_category->getId(),$shopbycat)):?>
			
				<?php 
					$catg_coll = Mage::getModel('catalog/category')->getCollection();
					foreach($catg_coll as $catg_data):
					if(in_array($catg_data->getId(),$shopbycat) && $catg_data->getId()>2):	
					$catg_data = Mage::getModel('catalog/category')->load($catg_data->getId());
					if($catg_data->getName() != 'Shop By Collection'){
				?>
						<li><a id="<?php if($curr_category && $catg_data->getId()==$curr_category->getData('entity_id')):?>left_product_active<?php endif;?>" href="<?php echo $catg_data->getUrl();?>"><?php echo $catg_data->getName();?></a></li>
						<?php } ?>
					<?endif;?>
				<?php endforeach;?>
			<?php elseif($curr_category && in_array($curr_category->getId(),$bunad) && $curr_category->getId()!='23'):?>
			
				<?php 
					$catg_coll = Mage::getModel('catalog/category')->getCollection();
					foreach($catg_coll as $catg_data):
					if(in_array($catg_data->getId(),$bunad) && $catg_data->getId()>2):	
					$catg_data = Mage::getModel('catalog/category')->load($catg_data->getId());
				?>
						<li><a id="<?php if($curr_category && $catg_data->getId()==$curr_category->getData('entity_id')):?>left_product_active<?php endif;?>" href="<?php echo $catg_data->getUrl();?>"><?php echo $catg_data->getName();?></a></li>
					<?endif;?>
				<?php endforeach;?>
				
			<?php else:?>
				
				<?php 
					$catg_coll = Mage::getModel('catalog/category')->getCollection();
					foreach($catg_coll as $catg_data):
					if(!in_array($catg_data->getId(),$shopbycat) && !in_array($catg_data->getId(),$bunad) && $catg_data->getId()>2):	
					$catg_data = Mage::getModel('catalog/category')->load($catg_data->getId());
				?>
						<li><a id="<?php if($curr_category && $catg_data->getId()==$curr_category->getData('entity_id')):?>left_product_active<?php endif;?>" href="<?php echo $catg_data->getUrl();?>"><?php echo $catg_data->getName();?></a></li>
					<?endif;?>
				<?php endforeach;?>
				
			<?php endif;?>
			
        </ul>
        <div class="spacer"></div>
		
    </div>
    
    <?php //endif;?>
    
    <div class="right_internal">
    <div class="product-essential">
    <form action="<?php echo $this->getSubmitUrl($_product) ?>" method="post" id="product_addtocart_form"<?php if($_product->getOptions()): ?> enctype="multipart/form-data"<?php endif; ?>>
        <?php echo $this->getBlockHtml('formkey') ?>
        <div class="no-display">
            <input type="hidden" name="product" value="<?php echo $_product->getId() ?>" />
            <input type="hidden" name="related_product" id="related-products-field" value="" />
        </div>
	<div class="left_internal_slider">
            <div class="product_detail_div">
                
                <?php echo $this->getChildHtml('media') ?>
                <div class="right_details">
                    <h1>COLLECTION: <?php echo $_helper->productAttribute($_product, $_product->getName(), 'name') ?></h1>
                    <?php if ($_product->getShortDescription()):?>
                    <span>
                        <?php  $shortdisc = $_helper->productAttribute($_product, nl2br($_product->getShortDescription()), 'short_description'); 
						
						echo $shortdiscresult = substr($shortdisc, 0,65).'.';
						?>
                    </span>
					 <br/><br/><br/>
                     <?php endif;?>
					
					 <!-- Add Art No. -->
					   <?php if ($_product->getArt_no()):?>
                    <span style="width: 179px;">
					<?php echo $labelart_no = $_product->getResource()->getAttribute('art_no')->getFrontend()->getLabel($_product).' : '; ?>
					<?php echo $_helper->productAttribute($_product, nl2br($_product->getArt_no()), 'art_no'); ?>
                    </span>
                     <?php endif;?>
					 
					<!-- Add Dimentions -->
					<?php if ($_product->getDimensions()):?>
                    <span style="width: 179px;">
					<?php echo $labeldimensions = $_product->getResource()->getAttribute('dimensions')->getFrontend()->getLabel($_product).' : '; ?>
                    <?php echo $_helper->productAttribute($_product, nl2br($_product->getDimensions()), 'dimensions'); ?>
                    </span>
                     <?php endif;?>
					 
					 
                    <?php if ($_product->isSaleable() && $this->hasOptions()):?>
                        <?php echo $this->getChildChildHtml('container1', '', true, true) ?>
                    <?php endif;?>
					
					<?php if (!$this->hasOptions()):?>
						<div style="margin-top:115px; clear:both; " >
							<?php echo $this->getChildHtml('addtocart') ?>
						</div>
					<?php endif; ?>
                    
               </div>
			   <div class="spacer"></div>
            </div>
			
			<?php  echo $this->getChildHtml('media1') ?>
			<div class="spacer"></div>
            
            
            <?php //echo $this->getReviewsSummaryHtml($_product, false, true)?>
            <?php //echo $this->getChildHtml('alert_urls') ?>
            <?php //echo $this->getChildHtml('product_type_data') ?>
            <?php //echo $this->getTierPriceHtml() ?>
            <?php //echo $this->getChildHtml('extrahint') ?>

            <!--<?php //if (!$this->hasOptions()):?>
                <div class="add-to-box">
                    <?php //if($_product->isSaleable()): ?>
                        <?php //echo $this->getChildHtml('addtocart') ?>
                        <?php //if( $this->helper('wishlist')->isAllow() || $_compareUrl=$this->helper('catalog/product_compare')->getAddUrl($_product)): ?>
                            <span class="or"><?php //echo $this->__('OR') ?></span>
                        <?php //endif; ?>
                    <?php //endif; ?>
                    <?php //echo $this->getChildHtml('addto') ?>
                </div>
                <?php //echo $this->getChildHtml('extra_buttons') ?>
            <?php //elseif (!$_product->isSaleable()): ?>
                <div class="add-to-box">
                    <?php //echo $this->getChildHtml('addto') ?>
                </div>
            <?php //endif; ?>-->

            
            <!--<?php //echo $this->getChildHtml('other');?>-->

            
        </div>
        
		    <div class="interanl_about_div">
            <h1><?php echo $this->__("ABOUT")?></h1>
            <p><?php echo $_helper->productAttribute($_product, nl2br($_product->getDescription()), 'description') ?></p>
            <!--<span>YOUR REVIEW</span>
            <img src="images/stars.png" width="98" height="18" />
            -->
            <?php echo $this->getReviewsSummaryHtml($_product, false, true)?>
            
            <!--<div class="chat_button"><a href="#">Chat</a></div>-->
            <div class="about_likes_buttn">
                <div class="like_01">
                    <a href="<?php echo Mage::getBaseUrl()."sizeguide"?>">SIZEGUIDE</a>
                </div>
                <div class="fb_like">
                    <!-- <a href="#"><img src="<?php echo $this->getSkinUrl('images/fb_icon.jpg')?>" width="24" height="21" /></a>
                    <label><a href="#">Link</a></label> -->
                    <!--Facebook like button code starts here  -->

    <?php $CurrentUrl = urlencode(Mage::helper('core/url')->getCurrentUrl()); ?>
    
   <iframe src="http://facebook.com/plugins/like.php?href=<?php echo $CurrentUrl; ?>&layout=button_count&show_faces=true&width=450&action=like&font=arial&colorscheme=light&height=21"  
 schrollowing="no" frameborder="0" style="border:none; overflow:hidden; width:450px; height:21px" allowTransparency="true"> </iframe> 

<!--Facebook like button code ends here  -->
                </div>

            </div>
            <div class="spacer"></div>
			<?php
				
				$related_prods = $_product->getRelatedProductIds(); 
				if(count($related_prods) > 0){				
				?>
			<div class="related_product_div">
                        	<h1>RELATED PRODUCTS</h1>
                            <div class="related_img_main">
                            <?php
				
							foreach($related_prods as $related){
							$_rel = Mage::getModel('catalog/product')->load($related); ?>
							<div class="related_01">
							<a href="<?php echo $_rel->getProductUrl(); ?>" title="<?php echo $_rel->getName(); ?>">
							<img src="<?php echo $_rel->getImageUrl(); ?>" width="75" height="75" alt="" style="border-bottom: 1px solid #3b3d43;"/>
							</a>
							</div>
							<?php	} ?>
					
                            	<div class="spacer"></div>
                            </div>
                        	<div class="spacer"></div>
                        </div>
						<?php } ?>
        
	
            <div class="spacer"></div>
        </div>
        <!--<div class="product-img-box">
            <?php echo $this->getChildHtml('media') ?>
        </div>-->
       <div class="spacer"></div>
      
					
					<?php 
					
					// Prev-Next links
					$_product = $this->getProduct();
					//print_r($_product->getCategoryIds());
					if(!$_product->getCategoryIds())
					 return; // if product is not in any category, do not display prev-next :)

					$cat_ids = $_product->getCategoryIds(); // get all categories where the product is located
					//print_r($cat_ids);
					//$currcatidpro = array($curr_category->getData('entity_id'));
					//$currentcatproid = array_intersect($currcatidpro,$cat_ids);
					$cat = Mage::getModel('catalog/category')->load( $cat_ids[0] ); // $currentcatproidload first category, you should enhance this, it works for me

					$order = Mage::getStoreConfig('catalog/frontend/default_sort_by');
					$direction = 'asc'; // asc or desc

					$category_products = $cat->getProductCollection()->addAttributeToSort($order, $direction);
					$category_products->addAttributeToFilter('status',1); // 1 or 2
					$category_products->addAttributeToFilter('visibility',4); // 1.2.3.4

					$cat_prod_ids = $category_products->getAllIds(); // get all products from the category
					$_product_id = $_product->getId();

					$_pos = array_search($_product_id, $cat_prod_ids); // get position of current product
					$_next_pos = $_pos+1;
					$_prev_pos = $_pos-1;

					// get the next product url
					 if( isset($cat_prod_ids[$_next_pos]) ) {
					 $_next_prod = Mage::getModel('catalog/product')->load( $cat_prod_ids[$_next_pos] );
					 } else {
					 $_next_prod = Mage::getModel('catalog/product')->load( reset($cat_prod_ids) );
					 }
					// get the prev product url
					 if( isset($cat_prod_ids[$_prev_pos]) ) {
					 $_prev_prod = Mage::getModel('catalog/product')->load( $cat_prod_ids[$_prev_pos] );
					 } else {
					 $_prev_prod = Mage::getModel('catalog/product')->load( end($cat_prod_ids) );
					 }
					?>

					<!-- <div class="next_preview">
					 <?php if($_prev_prod != NULL): ?>
					 <div class="preview"> <a href="<?php print $_prev_prod->getUrlPath(); if($search_parameter):?>?search=1<?php endif;?>" class="product-prev"><?php echo $this->__('< previous')?></a></div>
					 <?php endif; ?>

					 <?php if($_next_prod != NULL): ?>
					 <div class="next">
					 <a href="<?php print $_next_prod->getUrlPath(); if($search_parameter):?>?search=1<?php endif;?>" class="product-next"><?php echo $this->__('next product >')?></a></div>
					 <?php endif; ?>
					 	<div class="spacer"></div>
					</div>-->
       <div class="spacer"></div>
        <div class="clearer"></div>
        <?php if ($_product->isSaleable() && $this->hasOptions()):?>
            <?php echo $this->getChildChildHtml('container2', '', true, true) ?>
        <?php endif;?>
    </form>
    <script type="text/javascript">
    //<![CDATA[
        var productAddToCartForm = new VarienForm('product_addtocart_form');
        productAddToCartForm.submit = function(button, url) {
            if (this.validator.validate()) {
                var form = this.form;
                var oldUrl = form.action;

                if (url) {
                   form.action = url;
                }
                var e = null;
                try {
                    this.form.submit();
                } catch (e) {
                }
                this.form.action = oldUrl;
                if (e) {
                    throw e;
                }

                if (button && button != 'undefined') {
                    button.disabled = true;
                }
            }
        }.bind(productAddToCartForm);

        productAddToCartForm.submitLight = function(button, url){
            if(this.validator) {
                var nv = Validation.methods;
                delete Validation.methods['required-entry'];
                delete Validation.methods['validate-one-required'];
                delete Validation.methods['validate-one-required-by-name'];
                // Remove custom datetime validators
                for (var methodName in Validation.methods) {
                    if (methodName.match(/^validate-datetime-.*/i)) {
                        delete Validation.methods[methodName];
                    }
                }

                if (this.validator.validate()) {
                    if (url) {
                        this.form.action = url;
                    }
                    this.form.submit();
                }
                Object.extend(Validation.methods, nv);
            }
        }.bind(productAddToCartForm);
    //]]>
    </script>
    </div>

    </div>
	
	<?php echo $this->getChildHtml('product_additional_data') ?>
	
    <!--<div class="product-collateral">
<?php foreach ($this->getChildGroup('detailed_info', 'getChildHtml') as $alias => $html):?>
        <div class="box-collateral <?php echo "box-{$alias}"?>">
            <?php if ($title = $this->getChildData($alias, 'title')):?>
            <h2><?php echo $this->escapeHtml($title); ?></h2>
            <?php endif;?>
            <?php echo $html; ?>
        </div>
<?php endforeach;?>
        <?php echo $this->getChildHtml('upsell_products') ?>
        <?php echo $this->getChildHtml('product_additional_data') ?>
</div>-->
</div>
